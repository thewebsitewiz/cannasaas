/**
 * @file SearchBar.module.css
 * @path apps/storefront/src/layouts/StorefrontLayout/components/Header/components/SearchBar/
 *
 * Styles for the SearchBar combobox component.
 *
 * DESIGN SYSTEM TOKENS: All colors, radii, and spacing pull from the global
 * CSS custom properties defined in StorefrontLayout.module.css (--cs-* vars).
 *
 * RESPONSIVE BREAKPOINTS:
 *   • < 640px  (mobile): full-width below the logo row, icon-only trigger
 *   • 640–1023px (tablet): medium width inline in header
 *   • ≥ 1024px (desktop): full expanded width
 *
 * WCAG:
 *   • Focus ring uses outline-offset so it never overlaps text (§1.4.11).
 *   • Hover + active states are distinct (§1.4.1 – not color-only).
 *   • .srOnly class meets WCAG technique C7 for visually-hidden live regions.
 */

/* ─── Container ─────────────────────────────────────────────────────────── */

.searchBar {
  position: relative;
  width: 100%;
  max-width: 520px;
  flex: 1 1 auto;
}

/* ─── Form Row ───────────────────────────────────────────────────────────── */

.form {
  display: flex;
  align-items: center;
  gap: 0;
  background: var(--cs-surface-raised);
  border: 1.5px solid var(--cs-border);
  border-radius: var(--cs-radius-full);
  padding: 0 var(--cs-space-2);
  transition:
    border-color 180ms ease,
    box-shadow 180ms ease;
}

.form:focus-within {
  border-color: var(--cs-accent);
  box-shadow: 0 0 0 3px rgba(var(--cs-accent-rgb), 0.18);
}

/* ─── Search Icon ────────────────────────────────────────────────────────── */

.searchIcon {
  display: flex;
  align-items: center;
  color: var(--cs-text-muted);
  padding: 0 var(--cs-space-2) 0 var(--cs-space-1);
  flex-shrink: 0;
  pointer-events: none;
}

/* ─── Input ──────────────────────────────────────────────────────────────── */

.input {
  flex: 1 1 auto;
  min-width: 0;           /* Prevents overflow in flex containers */
  background: transparent;
  border: none;
  outline: none;
  color: var(--cs-text-primary);
  font-family: var(--cs-font-body);
  font-size: 0.9rem;
  letter-spacing: 0.01em;
  padding: var(--cs-space-3) 0;
  line-height: 1.4;

  /* Remove browser default search input decorations */
  appearance: none;
  -webkit-appearance: none;
}

.input::placeholder {
  color: var(--cs-text-muted);
  opacity: 1; /* Firefox reduces opacity by default */
}

/* Hide default "X" clear button added by WebKit – we render our own */
.input::-webkit-search-cancel-button {
  display: none;
}

.input::-webkit-search-decoration {
  display: none;
}

/* ─── Clear Button ───────────────────────────────────────────────────────── */

.clearButton {
  display: flex;
  align-items: center;
  justify-content: center;

  /* Minimum 44×44px touch target per WCAG 2.5.5 */
  min-width: 36px;
  min-height: 36px;
  padding: var(--cs-space-1);

  background: transparent;
  border: none;
  border-radius: 50%;
  color: var(--cs-text-muted);
  cursor: pointer;
  flex-shrink: 0;
  transition: color 150ms ease, background 150ms ease;
}

.clearButton:hover {
  color: var(--cs-text-primary);
  background: var(--cs-surface-hover);
}

.clearButton:focus-visible {
  outline: 2px solid var(--cs-accent);
  outline-offset: 2px;
}

/* ─── Submit Button ──────────────────────────────────────────────────────── */

.submitButton {
  /* Visually styled as a pill badge inside the search bar */
  flex-shrink: 0;
  padding: var(--cs-space-1-5) var(--cs-space-3);
  margin-left: var(--cs-space-1);
  margin-right: 2px;

  background: var(--cs-accent);
  color: var(--cs-accent-fg);
  border: none;
  border-radius: var(--cs-radius-full);
  font-family: var(--cs-font-body);
  font-size: 0.8rem;
  font-weight: 600;
  letter-spacing: 0.04em;
  text-transform: uppercase;
  cursor: pointer;
  transition: background 150ms ease, transform 100ms ease;

  /* Minimum touch target height */
  min-height: 32px;
}

.submitButton:hover {
  background: var(--cs-accent-hover);
}

.submitButton:active {
  transform: scale(0.97);
}

.submitButton:focus-visible {
  outline: 2px solid var(--cs-accent);
  outline-offset: 3px;
}

/* ─── Suggestion Listbox ─────────────────────────────────────────────────── */

.listbox {
  position: absolute;
  top: calc(100% + 8px);
  left: 0;
  right: 0;
  z-index: var(--cs-z-dropdown);

  list-style: none;
  margin: 0;
  padding: var(--cs-space-1) 0;

  background: var(--cs-surface-elevated);
  border: 1px solid var(--cs-border);
  border-radius: var(--cs-radius-lg);
  box-shadow: var(--cs-shadow-lg);

  /* Subtle entrance animation */
  animation: listboxIn 140ms cubic-bezier(0.16, 1, 0.3, 1) both;
}

@keyframes listboxIn {
  from {
    opacity: 0;
    transform: translateY(-6px) scale(0.98);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

/* ─── Option Row ─────────────────────────────────────────────────────────── */

.option {
  display: flex;
  align-items: center;
  gap: var(--cs-space-2);
  padding: var(--cs-space-2-5) var(--cs-space-4);
  cursor: pointer;
  transition: background 120ms ease;

  /* Minimum 44px touch height */
  min-height: 44px;
}

.option:hover,
.optionActive {
  background: var(--cs-surface-hover);
}

.optionType {
  display: flex;
  align-items: center;
  color: var(--cs-accent);
  flex-shrink: 0;
}

.optionLabel {
  flex: 1 1 auto;
  color: var(--cs-text-primary);
  font-size: 0.9rem;
  font-family: var(--cs-font-body);

  /* Truncate long product names */
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.optionPrice {
  flex-shrink: 0;
  color: var(--cs-text-muted);
  font-size: 0.85rem;
  font-variant-numeric: tabular-nums;
}

/* ─── Screen Reader Only (WCAG Utility) ──────────────────────────────────── */

.srOnly {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/* ─── Responsive ─────────────────────────────────────────────────────────── */

@media (max-width: 639px) {
  /* On mobile the SearchBar expands to full width below the logo row.
     The Header component handles the layout shift; here we just ensure
     the form fills its container. */
  .searchBar {
    max-width: 100%;
  }

  .submitButton {
    /* Hide text label on very narrow screens, keep accessible via aria-label */
    font-size: 0;
    padding: var(--cs-space-1-5);
    aspect-ratio: 1;
  }
}

@media (prefers-reduced-motion: reduce) {
  .listbox {
    animation: none;
  }

  .form,
  .clearButton,
  .submitButton,
  .option {
    transition: none;
  }
}

