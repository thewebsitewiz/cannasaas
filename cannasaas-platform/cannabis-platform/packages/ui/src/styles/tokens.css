/* =============================================================================
 * CannaSaas — Design Token System
 * packages/ui/src/styles/tokens.css
 *
 * LAYER ORDER
 * 1. Primitives   — raw color/size values, NEVER referenced in components
 * 2. Semantic     — role-based aliases (--color-brand, --color-surface, …)
 * 3. Component    — scoped overrides applied via CVA variant classes
 *
 * MULTI-TENANT THEMING
 * ThemeProvider (src/providers/ThemeProvider.tsx) reads BrandingConfig from
 * the organizationStore and overwrites the brand primitive tokens at runtime:
 *   document.documentElement.style.setProperty('--p-brand-500', '#hexvalue')
 * All component styles reference semantic aliases, so swapping a dispensary's
 * brand requires no component-level changes.
 *
 * WCAG 2.1 AA COMPLIANCE NOTES
 * • All semantic text/bg pairings enforce ≥ 4.5:1 contrast (normal text)
 * • Large text pairings enforce ≥ 3:1 contrast
 * • Focus ring is 3px solid brand color with 2px offset — clearly visible
 * • prefers-reduced-motion disables all transitions globally at the bottom
 * =============================================================================
 */

/* ── LAYER 1: PRIMITIVES ─────────────────────────────────────────────────── */
:root {
  /* ── Brand palette (defaults — overridden per-dispensary by ThemeProvider) */
  --p-brand-50:  #f0fdf4;
  --p-brand-100: #dcfce7;
  --p-brand-200: #bbf7d0;
  --p-brand-300: #86efac;
  --p-brand-400: #4ade80;
  --p-brand-500: #22c55e;   /* Primary CTA colour */
  --p-brand-600: #16a34a;
  --p-brand-700: #15803d;
  --p-brand-800: #166534;
  --p-brand-900: #14532d;
  --p-brand-950: #052e16;

  /* ── Neutral palette */
  --p-neutral-0:   #ffffff;
  --p-neutral-50:  #f8fafc;
  --p-neutral-100: #f1f5f9;
  --p-neutral-200: #e2e8f0;
  --p-neutral-300: #cbd5e1;
  --p-neutral-400: #94a3b8;
  --p-neutral-500: #64748b;
  --p-neutral-600: #475569;
  --p-neutral-700: #334155;
  --p-neutral-800: #1e293b;
  --p-neutral-900: #0f172a;
  --p-neutral-950: #020617;

  /* ── Semantic status */
  --p-success-light: #dcfce7;
  --p-success:       #16a34a;
  --p-success-dark:  #14532d;

  --p-warning-light: #fef9c3;
  --p-warning:       #d97706;
  --p-warning-dark:  #78350f;

  --p-error-light:   #fee2e2;
  --p-error:         #dc2626;
  --p-error-dark:    #7f1d1d;

  --p-info-light:    #dbeafe;
  --p-info:          #2563eb;
  --p-info-dark:     #1e3a8a;

  /* ── Type scale — 16px minimum base satisfies WCAG 1.4.4 body text */
  --p-text-xs:   0.75rem;    /* 12px */
  --p-text-sm:   0.875rem;   /* 14px */
  --p-text-base: 1rem;       /* 16px */
  --p-text-lg:   1.125rem;   /* 18px */
  --p-text-xl:   1.25rem;    /* 20px */
  --p-text-2xl:  1.5rem;     /* 24px */
  --p-text-3xl:  1.875rem;   /* 30px */
  --p-text-4xl:  2.25rem;    /* 36px */
  --p-text-5xl:  3rem;       /* 48px */

  /* ── Spacing (4px base grid) */
  --p-space-0:   0;
  --p-space-px:  1px;
  --p-space-0-5: 0.125rem;   /*  2px */
  --p-space-1:   0.25rem;    /*  4px */
  --p-space-2:   0.5rem;     /*  8px */
  --p-space-3:   0.75rem;    /* 12px */
  --p-space-4:   1rem;       /* 16px */
  --p-space-5:   1.25rem;    /* 20px */
  --p-space-6:   1.5rem;     /* 24px */
  --p-space-8:   2rem;       /* 32px */
  --p-space-10:  2.5rem;     /* 40px */
  --p-space-12:  3rem;       /* 48px */
  --p-space-16:  4rem;       /* 64px */
  --p-space-20:  5rem;       /* 80px */

  /* ── Border radius */
  --p-radius-none: 0;
  --p-radius-sm:   0.25rem;   /*  4px */
  --p-radius-md:   0.5rem;    /*  8px */
  --p-radius-lg:   0.75rem;   /* 12px */
  --p-radius-xl:   1rem;      /* 16px */
  --p-radius-2xl:  1.5rem;    /* 24px */
  --p-radius-full: 9999px;

  /* ── Shadows */
  --p-shadow-sm:  0 1px 2px 0 rgb(0 0 0 / 0.05);
  --p-shadow-md:  0 4px 6px -1px rgb(0 0 0 / 0.10), 0 2px 4px -2px rgb(0 0 0 / 0.10);
  --p-shadow-lg:  0 10px 15px -3px rgb(0 0 0 / 0.10), 0 4px 6px -4px rgb(0 0 0 / 0.10);
  --p-shadow-xl:  0 20px 25px -5px rgb(0 0 0 / 0.10), 0 8px 10px -6px rgb(0 0 0 / 0.10);
  --p-shadow-2xl: 0 25px 50px -12px rgb(0 0 0 / 0.25);

  /* ── Motion */
  --p-dur-instant: 0ms;
  --p-dur-fast:    150ms;
  --p-dur-normal:  250ms;
  --p-dur-slow:    400ms;
  --p-dur-slower:  600ms;
  --p-ease:        cubic-bezier(0.4, 0, 0.2, 1);
  --p-ease-in:     cubic-bezier(0.4, 0, 1, 1);
  --p-ease-out:    cubic-bezier(0, 0, 0.2, 1);
  --p-ease-spring: cubic-bezier(0.175, 0.885, 0.32, 1.275);

  /* ── Z-index scale */
  --p-z-below:    -1;
  --p-z-base:      0;
  --p-z-raised:    1;
  --p-z-dropdown:  10;
  --p-z-sticky:    20;
  --p-z-overlay:   30;
  --p-z-modal:     40;
  --p-z-toast:     50;
  --p-z-tooltip:   60;
}


/* ── LAYER 2: SEMANTIC ALIASES — LIGHT MODE ─────────────────────────────── */
:root,
[data-color-scheme="light"] {
  /* Brand */
  --color-brand:         var(--p-brand-500);
  --color-brand-hover:   var(--p-brand-700);
  --color-brand-active:  var(--p-brand-800);
  --color-brand-subtle:  var(--p-brand-50);
  --color-brand-muted:   var(--p-brand-100);
  --color-brand-text:    var(--p-brand-900);
  --color-text-on-brand: #ffffff;

  /* Surfaces */
  --color-bg:             var(--p-neutral-0);
  --color-bg-secondary:   var(--p-neutral-50);
  --color-bg-tertiary:    var(--p-neutral-100);
  --color-surface:        var(--p-neutral-0);
  --color-surface-raised: var(--p-neutral-50);
  --color-surface-overlay: rgb(255 255 255 / 0.85);

  /* Borders */
  --color-border:        var(--p-neutral-200);
  --color-border-strong: var(--p-neutral-300);
  --color-border-brand:  var(--p-brand-300);

  /* Text */
  --color-text:           var(--p-neutral-900);
  --color-text-secondary: var(--p-neutral-500);
  --color-text-tertiary:  var(--p-neutral-400);
  --color-text-disabled:  var(--p-neutral-300);
  --color-text-inverse:   var(--p-neutral-0);

  /* Status colours (background / foreground pairs) */
  --color-success-bg:   var(--p-success-light);
  --color-success:      var(--p-success);
  --color-success-text: var(--p-success-dark);

  --color-warning-bg:   var(--p-warning-light);
  --color-warning:      var(--p-warning);
  --color-warning-text: var(--p-warning-dark);

  --color-error-bg:     var(--p-error-light);
  --color-error:        var(--p-error);
  --color-error-text:   var(--p-error-dark);

  --color-info-bg:      var(--p-info-light);
  --color-info:         var(--p-info);
  --color-info-text:    var(--p-info-dark);

  /* Focus — WCAG 2.4.7 Focus Visible: 3px solid, clearly visible */
  --color-focus-ring: var(--p-brand-500);
  --focus-ring: 0 0 0 3px var(--color-focus-ring);

  /* Shadows — reuse primitives */
  --shadow-sm:  var(--p-shadow-sm);
  --shadow-md:  var(--p-shadow-md);
  --shadow-lg:  var(--p-shadow-lg);
  --shadow-xl:  var(--p-shadow-xl);
  --shadow-2xl: var(--p-shadow-2xl);
}


/* ── LAYER 2: SEMANTIC ALIASES — DARK MODE ──────────────────────────────── */
[data-color-scheme="dark"] {
  /* Brand — lighter shades for dark-bg contrast */
  --color-brand:         var(--p-brand-400);
  --color-brand-hover:   var(--p-brand-300);
  --color-brand-active:  var(--p-brand-200);
  --color-brand-subtle:  var(--p-brand-950);
  --color-brand-muted:   var(--p-brand-900);
  --color-brand-text:    var(--p-brand-100);
  --color-text-on-brand: var(--p-neutral-950);

  /* Surfaces — GitHub-style dark palette */
  --color-bg:             #0d1117;
  --color-bg-secondary:   #161b22;
  --color-bg-tertiary:    #21262d;
  --color-surface:        #1c2128;
  --color-surface-raised: #2d333b;
  --color-surface-overlay: rgb(13 17 23 / 0.85);

  /* Borders */
  --color-border:        #30363d;
  --color-border-strong: #484f58;
  --color-border-brand:  var(--p-brand-800);

  /* Text */
  --color-text:           #e6edf3;
  --color-text-secondary: #8b949e;
  --color-text-tertiary:  #6e7681;
  --color-text-disabled:  #484f58;
  --color-text-inverse:   var(--p-neutral-950);

  /* Status — dark-mode adjusted backgrounds */
  --color-success-bg:   rgb(22 163 74 / 0.15);
  --color-success:      #4ade80;
  --color-success-text: #86efac;

  --color-warning-bg:   rgb(217 119 6 / 0.15);
  --color-warning:      #fbbf24;
  --color-warning-text: #fde68a;

  --color-error-bg:     rgb(220 38 38 / 0.15);
  --color-error:        #f87171;
  --color-error-text:   #fca5a5;

  --color-info-bg:      rgb(37 99 235 / 0.15);
  --color-info:         #60a5fa;
  --color-info-text:    #bfdbfe;

  /* Focus */
  --color-focus-ring: var(--p-brand-400);

  /* Dark-mode shadows — more opaque */
  --shadow-sm:  0 1px 2px 0 rgb(0 0 0 / 0.40);
  --shadow-md:  0 4px 6px -1px rgb(0 0 0 / 0.50);
  --shadow-lg:  0 10px 15px -3px rgb(0 0 0 / 0.50);
  --shadow-xl:  0 20px 25px -5px rgb(0 0 0 / 0.50);
  --shadow-2xl: 0 25px 50px -12px rgb(0 0 0 / 0.70);
}


/* ── LAYER 3: GLOBAL RESETS WITH ACCESSIBILITY DEFAULTS ─────────────────── */

*,
*::before,
*::after {
  box-sizing: border-box;
}

html {
  /* Prevent iOS font-size inflation */
  -webkit-text-size-adjust: 100%;
  /* Smooth scrolling (disabled below for reduced-motion users) */
  scroll-behavior: smooth;
  /* Ensure background covers full viewport in dark mode */
  background-color: var(--color-bg);
}

body {
  margin: 0;
  padding: 0;
  font-family: var(--font-body, ui-sans-serif, system-ui, -apple-system,
    BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial,
    'Noto Sans', sans-serif);
  font-size: var(--p-text-base);  /* 16px — WCAG 1.4.4 minimum */
  line-height: 1.5;
  color: var(--color-text);
  background-color: var(--color-bg);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

h1, h2, h3, h4, h5, h6 {
  font-family: var(--font-heading, inherit);
  color: var(--color-text);
  line-height: 1.2;
}

/* Remove list styling when used for navigation / cards */
ul[role="list"],
ol[role="list"] {
  list-style: none;
  margin: 0;
  padding: 0;
}

/* Images don't overflow their containers */
img, video {
  max-width: 100%;
  height: auto;
  display: block;
}

/* Inherit font from body in forms */
input, button, textarea, select {
  font: inherit;
}

/* Remove default button appearance */
button {
  cursor: pointer;
  background: none;
  border: none;
  padding: 0;
}

/* Anchor colour */
a {
  color: var(--color-brand);
  text-decoration: none;
}
a:hover {
  text-decoration: underline;
}

/* ── WCAG 2.4.7 Focus Visible — globally applied ─────────────────────────── */
/* Replace the browser default (often invisible in dark mode) with our ring */
*:focus {
  outline: none;
}

*:focus-visible {
  outline: 3px solid var(--color-focus-ring);
  outline-offset: 2px;
  border-radius: var(--p-radius-sm);
}

/* ── WCAG 2.4.1 Bypass Blocks — skip-to-main-content link ───────────────── */
.skip-link {
  position: absolute;
  left: -9999px;
  top: auto;
  width: 1px;
  height: 1px;
  overflow: hidden;
  z-index: var(--p-z-toast);
}

.skip-link:focus,
.skip-link:focus-visible {
  position: fixed;
  left: var(--p-space-4);
  top: var(--p-space-4);
  width: auto;
  height: auto;
  padding: var(--p-space-3) var(--p-space-6);
  background-color: var(--color-brand);
  color: var(--color-text-on-brand);
  font-weight: 700;
  font-size: var(--p-text-base);
  border-radius: var(--p-radius-md);
  box-shadow: var(--shadow-lg);
  outline: 3px solid var(--color-text-on-brand);
  outline-offset: 2px;
}

/* ── Screen-reader only utility ──────────────────────────────────────────── */
/* Use this class on elements that must exist in the DOM for AT
   but should not be visible to sighted users. */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

/* Inverse: visible only to sighted users, hidden from AT */
.not-sr-only {
  position: static;
  width: auto;
  height: auto;
  padding: 0;
  margin: 0;
  overflow: visible;
  clip: auto;
  white-space: normal;
}

/* ── WCAG 2.3.3 Animation from Interactions — motion preference ──────────── */
/* Disables ALL motion for users who prefer reduced motion. Components must
   not override this with !important. Transition durations are set to 0.01ms
   (not 0ms) to avoid breaking JS that reads transition durations.) */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration:       0.01ms !important;
    animation-iteration-count: 1     !important;
    transition-duration:      0.01ms !important;
    scroll-behavior:          auto   !important;
  }

  html {
    scroll-behavior: auto;
  }
}

/* ── High-contrast mode support (Windows, macOS) ─────────────────────────── */
@media (forced-colors: active) {
  /* Preserve focus ring in high-contrast mode */
  *:focus-visible {
    outline: 3px solid ButtonText;
  }
}
