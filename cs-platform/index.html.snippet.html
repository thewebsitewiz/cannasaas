<!--
  @file wiring/index.html.snippet.html
  ADD THESE CHANGES to apps/{storefront,admin,staff}/index.html

  ─── Why an inline script? ───────────────────────────────────────────────────

  Without this script, users who prefer dark mode see a white flash on every
  page load before React hydrates and ThemeProvider applies the .dark class.

  This script runs synchronously before the browser's first paint (before CSS
  is even parsed), so the correct class is already on <html> before anything
  renders. This eliminates the flash entirely.

  WCAG 2.3.3 Animation from Interactions (AAA):
    The flash itself is an unsolicited visual change that can trigger
    photosensitivity reactions. This script prevents it.

  ─── Security: localStorage read ─────────────────────────────────────────────

  We only READ from localStorage — never write. The stored value is parsed
  via JSON.parse in a try/catch so malformed values fail gracefully.
  The mode string is only compared to literals ("dark", "system") — never
  eval'd or interpolated into HTML.

  ─── Transition suppression CSS ──────────────────────────────────────────────

  The [data-no-transitions] attribute is set on <html> by ThemeProvider on mount
  and removed after the first paint. This prevents transitions from firing during
  the initial hydration when ThemeProvider re-applies the dark class.

  Add this CSS to your global.css or index.css:
    [data-no-transitions] * {
      transition-duration: 0ms !important;
    }
-->

<!-- 1. Fonts: preconnect to Google Fonts for faster custom font loading -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

<!-- 2. Favicon: default favicon (ThemeProvider updates this with tenant favicon) -->
<link rel="icon" type="image/x-icon" href="/favicon.ico" />

<!-- 3. No-flash dark mode init script: runs BEFORE React loads -->
<script>
  /**
   * Dark mode initialization — runs synchronously before first paint.
   * Reads the stored theme preference and applies .dark class immediately
   * so there is never a flash of wrong theme.
   */
  (function() {
    try {
      var stored = localStorage.getItem("cs-theme-v1");
      var parsed = stored ? JSON.parse(stored) : null;
      var mode   = parsed && parsed.mode ? parsed.mode : "system";

      var isDark = mode === "dark" ||
        (mode === "system" && window.matchMedia("(prefers-color-scheme: dark)").matches);

      if (isDark) {
        document.documentElement.classList.add("dark");
      }
    } catch (e) {
      // localStorage unavailable or JSON parse error — default to light
    }
  })();
</script>
